<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan to Win! - Exclusive Offer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f2f5; /* Light gray background */
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
      box-sizing: border-box;
    }
    .qr-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      max-width: 450px;
      width: 100%;
      overflow: hidden;
      padding: 2.5rem;
      text-align: center;
    }
    .qr-header {
      margin-bottom: 1.5rem;
    }
    .qr-code-img {
      width: 200px;
      height: 200px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      margin: 1.5rem auto;
    }
    .action-button {
      background-color: #2563eb; /* Blue */
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.2s ease;
      width: 100%;
      margin-top: 1.5rem;
    }
    .action-button:hover {
      background-color: #1d4ed8;
    }
    .disclaimer-text {
      font-size: 0.85rem;
      color: #718096; /* Tailwind gray-500 */
      margin-top: 1.5rem;
    }

    /* Local Feedback Modal Styles (replicated) */
    .local-feedback-modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    .local-feedback-modal-overlay.show {
      display: flex;
      opacity: 1;
    }
    .local-feedback-modal-content {
      background: #fff;
      padding: 2.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      max-width: 90%;
      width: 450px;
      text-align: center;
      transform: translateY(20px);
      opacity: 0;
      transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
    }
    .local-feedback-modal-overlay.show .local-feedback-modal-content {
      transform: translateY(0);
      opacity: 1;
    }
    .local-feedback-modal-content .title-phish {
      color: #dc2626; /* Tailwind red-600 */
    }
    .local-feedback-modal-content .title-good {
      color: #10b981; /* Tailwind green-600 */
    }
  </style>
</head>
<body>

  <main class="qr-container">
    <div class="qr-header">
      <h1 class="text-3xl font-bold text-gray-800">Scan to Claim Your Prize!</h1>
      <p class="text-gray-600 mt-2">Exclusive offer for our loyal customers!</p>
    </div>

    <img src="PhishED.png" alt="QR Code to Scan" class="qr-code-img">

    <p class="text-gray-700 font-semibold mb-4">Scan this QR code with your phone to enter our prize draw!</p>
    <p class="text-red-500 font-bold">LIMITED TIME OFFER - Ends Today!</p>

    <button onclick="handleScanAttempt()" class="action-button">
      I Scanned the QR Code
    </button>

    <p class="disclaimer-text"></p>
  </main>

  <!-- Local Feedback Modal -->
  <div id="local-feedback-modal-overlay" class="local-feedback-modal-overlay">
    <div class="local-feedback-modal-content">
      <h3 id="local-modal-title" class="text-2xl font-bold mb-4"></h3>
      <p id="local-modal-message" class="text-gray-700 mb-6"></p>
      <button onclick="handleLocalModalClose()"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition duration-300 shadow-lg">
        Got It!
      </button>
    </div>
  </div>

  <script>
    let simulationId = ''; // To store the ID passed from parent
    let currentFeedbackData = null; // Store feedback data before showing local modal

    // Function to send feedback to the parent (simulate.html) via localStorage
    function sendFeedbackToParentAndClose(title, message, isPhish, simId) {
      localStorage.setItem('simulationFeedback', JSON.stringify({ title, message, isPhish, simulationId: simId }));
      setTimeout(() => {
        window.close(); // Close this tab
      }, 200); // Short delay for localStorage to save
    }

    // Function to show the local feedback modal
    function showLocalFeedbackModal(title, message, isPhish) {
      const modalOverlay = document.getElementById('local-feedback-modal-overlay');
      const modalTitle = document.getElementById('local-modal-title');
      const modalMessage = document.getElementById('local-modal-message');

      modalTitle.textContent = title;
      modalMessage.textContent = message;

      if (isPhish) {
        modalTitle.classList.remove('title-good');
        modalTitle.classList.add('title-phish');
      } else {
        modalTitle.classList.remove('title-phish');
        modalTitle.classList.add('title-good');
      }

      modalOverlay.classList.add('show');
    }

    // Handle closing the local modal and then sending feedback to parent
    function handleLocalModalClose() {
      document.getElementById('local-feedback-modal-overlay').classList.remove('show');
      if (currentFeedbackData) {
          sendFeedbackToParentAndClose(
              currentFeedbackData.title,
              currentFeedbackData.message,
              currentFeedbackData.isPhish,
              currentFeedbackData.simulationId
          );
      }
    }

    window.onload = function() {
        // Get simulationId from localStorage (set by simulate.html)
        simulationId = localStorage.getItem('currentSimulationId') || 'qr-phishing'; // Fallback ID
    };

    function handleScanAttempt() {
      const title = 'ðŸš¨ Warning: QR Code Phishing (Quishing)!';
      const message = 'You "scanned" a malicious QR code. These codes can lead to fake websites designed to steal your login credentials or install malware, just like malicious links. Always verify the source of QR codes before scanning!';
      const isPhish = true;
      currentFeedbackData = { title, message, isPhish, simulationId: simulationId };
      showLocalFeedbackModal(title, message, isPhish);
    }
  </script>
</body>
</html>
